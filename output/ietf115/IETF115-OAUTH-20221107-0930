# oauth

## Summary

The OAuth working group session covered updates on several active drafts, including OAuth 2.1, Browser-Based Apps, SD-JWT, Step-Up Authentication, and a new proposal for Interactive Authentication. Key discussions revolved around consolidating best practices into OAuth 2.1, managing CORS behavior for various OAuth endpoints, refining token storage recommendations for browser applications, addressing encoding and algorithm agility in SD-JWT, and exploring challenges in standardizing interactive authentication for non-web HTTP clients. Several action items and decisions were made regarding the direction and required clarity for these specifications.

## Key Discussion Points

*   **Work Group Updates:**
    *   **JWK Thumbprint URI** (Mike Jones, Christina Paquin) published as an RFC.
    *   **JWT Response for OAuth Token Introspection** (Roman) is in the RFC Editor queue, awaiting resolution of a misreference related to the Security Best Practices document.
    *   **DPoP document** is in revised I-D.
    *   **Security Best Practices** document is awaiting comments from Daniel Fett and Mike Jones.
    *   **Side Meeting for DPoP:** Will focus on Algorithm Agility, with Roman documenting the rationale for supporting more than five algorithms in the shepherd's write-up.

*   **OAuth 2.1 (Aaron Parecki):**
    *   **Consolidation:** Aims to merge existing OAuth 2.0 RFCs and best practices into a single, updated document.
    *   **Updates:** Abstract updated to remove "third-party", added multi-factor and passwordless authentication as motivations, mentioned Pushed Authorization Requests (PAR) for on-the-fly redirect URL registration, and noted CORS support for token endpoints for browser-based apps.
    *   **CORS Recommendations:** Discussion centered on adding a dedicated section on Cross-Origin Resource Sharing (CORS).
        *   **Authorization Endpoint:** Should *not* allow CORS.
        *   **Other Endpoints (Token, Metadata, PAR):** *Should* support CORS for browser-based applications.
        *   **Terminology:** Agreed to use "browser-based apps" instead of "JavaScript apps" to include WebAssembly (WASM).
        *   **Clarity:** Emphasized the need to distinguish between direct browser use (navigation) and JavaScript/WASM making HTTP requests.
    *   **`redirect_uri` at Token Endpoint:** Discussion on whether the `redirect_uri` parameter is still required for authorization code exchange, given its redundancy with PKCE for mix-up attacks.
        *   Concern was raised that removing it could create a new compatibility level for 2.1 clients interacting with 2.0 Authorization Servers (AS) that follow best practices but don't explicitly declare 2.1 compliance.
        *   The group acknowledged that if a client opts into 2.1 behavior, it might not expect perfect compatibility with older 2.0 servers.

*   **Browser-Based Apps Best Current Practice (Aaron Parecki):**
    *   **Purpose:** Provides recommendations for applications executing in a browser (SPAs) with or without a backend.
    *   **Architectural Patterns:** Four patterns are described: Single Domain, Backend-for-Frontend Proxy, Token Mediating Backend (newly added), and Token Acquisition in Browser.
    *   **Service Workers:** A subsection was added for token management within service workers.
    *   **Token Storage:** More notes added about storing tokens in local storage. Discussion arose about not using the browser's raw cookie API as a general token storage mechanism for JavaScript applications.
    *   **Future Updates:** Planned sections on various token storage techniques (in-memory, local/session storage, cookies) with their respective considerations, consistency review with the Security BCP, and a dedicated CORS section mirroring the 2.1 recommendations.

*   **SD-JWT (Selective Disclosure for JWTs) (Daniel Fett, Christina Paquin):**
    *   **Goal:** Simple implementation and usage for selective disclosure of claims in JWTs.
    *   **Terminology:** Updated to clarify objects: `Issuer Issued Disclosures` (II Disclosures - unsigned JSON object) and `Holder Selected Disclosures JWT` (HS Disclosures - signed or unsigned JWT).
    *   **Combined Format:** Defined for both issuance and presentation.
    *   **Digest Derivation Algorithms:** Expanded to allow algorithms beyond basic hashing (e.g., HMAC), with SHA-256 remaining mandatory-to-implement.
        *   Concerns were raised regarding the clarity and interoperability of supporting HMAC, especially regarding the treatment of salt/key and the underlying byte string derivation. The term "digest derivation algorithm" itself was noted as being non-standard and lengthy.
    *   **Signature Validation:** Clarified verifier policies for HS Disclosures, specifying whether signing (holder binding) is required or if unsigned disclosures are acceptable.
    *   **Encoding/Canonicalization:** Discussed the challenge of JSON's undefined element order and whitespace leading to inconsistent byte strings for hashing.
        *   The draft's approach of "source string encoding" (encoding complex JSON claims as JSON strings to be hashed) was presented as simpler than full canonicalization.
        *   Concerns were raised about the *precision* required for this approach, particularly with Unicode and escape characters, to ensure consistent byte string extraction across implementations.
    *   **Claim Name Blinding:** A new feature to replace claim names with random strings for selective disclosure, with the original name provided in the disclosure object.
    *   **Processing Model:** Described a model where an SD-JWT library handles the complexity to output a standard JWT for applications.
    *   **Implementations:** Five running implementations.

*   **Step-Up Authentication Challenge Protocol (Brian Campbell):**
    *   **Problem:** Resource Servers (RS) often need stronger or more recent authentication (e.g., for high-value operations) than the current access token provides. No standardized mechanism for RS to communicate these requirements to the client, and for the client to convey them to the Authorization Server (AS).
    *   **Approach:** Extends RFC 6750 with a new `insufficient_user_authentication` error and `acr_values`/`max_age` parameters in the `WWW-Authenticate` header. Clients use existing `acr_values`/`max_age` authorization request parameters to the AS. RS obtains `acr` and `auth_time` via introspection or JWT claims.
    *   **Current Status:** WGLC completed, editorial updates, explicit clarification that authorization requests are via the user agent. Draft 6 was published just prior to the meeting.
    *   **Feedback:** Addressed Taka's feedback on clarity, confirming no protocol changes.
    *   **Structural Fields:** Suggestion to review alignment with HTTP Structured Fields work for `WWW-Authenticate` header parameters.

*   **Interactive Authentication (Ben Campbell):**
    *   **Problem:** Non-web HTTP clients (e.g., CalDAV, proxies, CLIs) are limited to older authentication methods, unable to leverage modern OAuth, SSO, and 2FA. OAuth typically assumes the client knows the AS in advance. This draft addresses clients accessing *any* HTTP resource that requires an authentication prompt.
    *   **Proposed UX:** A device notification triggers a browser pop-up for login (potentially OAuth-driven SSO), which closes upon successful authentication, allowing the non-interactive client to proceed using copied credentials (cookies/Authorization headers).
    *   **Protocol Overview:** Server challenges with `WWW-Authenticate: location=/login`. Client opens browser to this location. Browser performs authentication. Upon success, client copies headers (cookies/Authorization) from the successful browser request for subsequent non-interactive use.
    *   **Input Sought:** How can components be shared with the OAuth ecosystem? Where should this draft's adoption live?
    *   **Concerns Raised:**
        *   **Fishing Risk:** Historically, RS advertising AS was avoided due to phishing concerns; this model requires deep security review.
        *   **Browser Security:** Copying headers out of a browser may conflict with modern browser and OS security mechanisms (e.g., WebAuthn, proof-of-possession for cookies).
        *   **Orchestration:** Clarity needed on whether orchestration is by the client application or the user agent.

## Decisions and Action Items

*   **JWT Response for OAuth Token Introspection:**
    *   **Decision:** Will wait for the Security Best Practices document to be released before pushing this document further in the RFC Editor queue.
*   **DPoP A.D. Review:**
    *   **Action:** Roman to document the rationale for supporting more than five algorithms in the shepherd's write-up for algorithm agility.
*   **Security Best Practices Document:**
    *   **Action:** Daniel Fett and Mike Jones to contribute their comments to the document as soon as possible.
*   **OAuth 2.1 - CORS Section:**
    *   **Decision:** Add a dedicated CORS section to OAuth 2.1.
        *   Explicitly state that the Authorization Endpoint should *not* allow CORS.
        *   Specify that the Token, Metadata, and PAR endpoints *should* support CORS.
        *   Use "browser-based apps" instead of "JavaScript apps" for broader applicability.
    *   **Action:** Aaron Parecki to add this section.
*   **OAuth 2.1 - `redirect_uri` at Token Endpoint:**
    *   **Decision:** A 2.1 compliant Authorization Server should accept and verify the `redirect_uri` parameter if present, but *not* require it.
    *   **Action:** Aaron Parecki to document this decision, including the potential breaking behavior for 2.1 clients interacting with 2.0+BCP Authorization Servers, in the "differences" section of OAuth 2.1. The group will revisit this decision after the full "differences" section is complete for broader context.
*   **Browser-Based Apps - Cookie API for Token Storage:**
    *   **Decision:** The document should explicitly recommend *against* using the browser's raw cookie API as a general token storage mechanism for JavaScript applications.
    *   **Action:** Aaron Parecki to add this to the document.
*   **SD-JWT - Digest Derivation Algorithms:**
    *   **Action:** A GitHub issue will be opened for a detailed discussion on the `digest derivation algorithm` terminology and the interoperability/specification requirements for supporting HMAC.
*   **SD-JWT - Holder Binding and Device Binding:**
    *   **Action:** Clarify the relationship between holder binding and device binding in the SD-JWT document.
*   **SD-JWT - Encoding/Canonicalization Precision:**
    *   **Action:** Authors to add precise guidance to the spec on *how* byte streams are extracted from JSON strings for hashing, addressing subtleties in JSON parsing and Unicode encoding to ensure interoperability and robustness in corner cases.

## Next Steps

*   **OAuth 2.1:**
    *   Aaron Parecki to continue incorporating Justin Richer's write-ups, moving normative language to core sections, and adding an explicit section detailing core differences from OAuth 2.0.
    *   Aaron Parecki to complete the new CORS section and update `redirect_uri` behavior documentation.
*   **Browser-Based Apps:**
    *   Aaron Parecki to add dedicated sections on general token storage techniques (in-memory, local/session storage, cookies) and a CORS recommendations section.
    *   Aim for mailing list discussion on these new sections over the next couple of months to prepare for pushing the draft to completion.
*   **SD-JWT:**
    *   Consider the implications and potential mappings to other existing credential formats.
    *   Add comprehensive security and privacy considerations.
    *   Plan for interoperability testing between implementations, which can be conducted offline.
    *   Discuss separating the HS Disclosures (unsigned JSON object) from the holder binding (optional signed JWT).
*   **Step-Up Authentication:**
    *   Await the shepherd's review for draft 6.
*   **Interactive Authentication:**
    *   Ben Campbell to continue discussions on the mailing list and with relevant working groups (e.g., HTTP API, Privacy Pass) regarding the protocol's components, potential integration with existing OAuth mechanisms, and addressing security concerns related to phishing, browser limitations, and cookie exfiltration. Seeking workgroup adoption.